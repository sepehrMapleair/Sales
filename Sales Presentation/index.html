<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home Comfort Packages</title>
  <!-- Font Awesome for colorful icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-pO2YiSEn0V1l6cV9ZFXmEg1eD02cHFefo1Vs/9JkbDQSYoSP5K6xT8XE6uK80DGkBCWoaXSdBfaR1nwF4rXrzg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* Reset & basic typography */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, Helvetica, sans-serif;
      line-height: 1.5;
      background-color: #f7f9fc;
      color: #333;
    }
    a { text-decoration: none; color: inherit; }
    /* Header styling */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      background-color: #002c5f; /* deep blue */
      color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      flex-wrap: wrap;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .phone-badge {
      background-color: #e01c2d;
      color: #fff;
      padding: 6px 12px;
      border-radius: 4px;
      font-weight: 600;
      font-size: 0.9rem;
      margin-top: 8px;
    }
    header img.logo {
      height: 50px;
      margin-right: 16px;
    }
    header h1 {
      font-size: 1.8rem;
      font-weight: 600;
    }

    /* Category grid */
    .categories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
      padding: 40px 20px;
      max-width: 100%;
      margin: 0 auto;
    }
    .category-card {
      background-color: #fff;
      border-radius: 12px;
      padding: 24px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.25s, box-shadow 0.25s;
      text-align: center;
      border: 1px solid #d7dfe8;
      min-height: 260px;
    }
    .category-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
      border-color: #b3c0d1;
    }
    .category-card h2 {
      font-size: 1.3rem;
      margin-bottom: 6px;
      color: #002c5f;
      font-weight: 600;
    }
    /* Icons displayed on package cards */
    .unit-icons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-top: 8px;
    }
    /* Icons styling for package cards */
    .unit-icons i {
      font-size: 28px;
      line-height: 1;
    }
    /* Circular icon wrappers used for coloured package icons */
    .unit-icons .icon-wrapper {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border-radius: 50%;
    }
    .unit-icons .icon-wrapper img {
      width: 20px;
      height: 20px;
      filter: invert(1);
    }
    .package-size-range {
      font-size: 0.85rem;
      color: #444;
      margin-top: 6px;
    }
    /* Redesigned variant cards */
    .variant-card {
      border: 1px solid #d7dfe8;
      border-radius: 12px;
      background-color: #fff;
      margin-bottom: 20px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .variant-header {
      background-color: #002c5f;
      color: #fff;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .variant-header h3 {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
    }
    .variant-header .size-label {
      margin-left: 12px;
      font-size: 1.1rem;
      font-style: italic;
    }
    .variant-body {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      padding: 16px;
    }
    .unit-box, .accessory-box, .service-box {
      background-color: #013e7d;
      color: #fff;
      border-radius: 8px;
      padding: 12px;
      flex: 1;
      min-width: 140px;
    }
    .unit-box h4, .accessory-box h4, .service-box h4 {
      margin-bottom: 6px;
      font-size: 0.95rem;
      font-weight: 600;
    }
    .unit-box ul, .accessory-box ul, .service-box ul {
      list-style-type: disc;
      margin-left: 18px;
      margin-bottom: 0;
      font-size: 1rem;
      line-height: 1.35;
      color: #ffffff;
    }
    .unit-box li, .accessory-box li, .service-box li {
      color: #ffffff;
    }
    .price-container {
      flex: 1;
      min-width: 180px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: stretch;
    }
    .price-main {
      background-color: #06529c;
      color: #fff;
      border-radius: 8px;
      padding: 16px;
      text-align: center;
      font-size: 1.4rem;
      font-weight: 700;
    }
    .price-main .price-label {
      font-size: 0.9rem;
      display: block;
      margin-bottom: 4px;
    }
    .plan-box, .care-box {
      background-color: #e01c2d;
      color: #fff;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      font-size: 0.85rem;
      font-weight: 600;
    }
    .variant-select {
      background-color: #e01c2d;
      color: #fff;
      border: none;
      border-radius: 0 0 12px 12px;
      padding: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .variant-select:hover {
      background-color: #c21823;
    }
    /* Print quote styling: show only summary */
    @media print {
      body * {
        visibility: hidden;
      }
      #quote-summary, #quote-summary * {
        visibility: visible;
      }
      #quote-summary {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
      #quote-summary .actions {
        display: none;
      }
    }
    /* Modal overlay */
    #modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }
    #modal-overlay.active {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }
    .modal-content {
      background-color: #fff;
      border-radius: 12px;
      width: 92%;
      max-width: 640px;
      max-height: 85vh;
      overflow-y: auto;
      padding: 24px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.2);
      position: relative;
      border: 1px solid #d7dfe8;
    }
    .modal-title {
      font-size: 1.6rem;
      margin-bottom: 18px;
      color: #002c5f;
      font-weight: 600;
    }
    .modal-close {
      position: absolute;
      top: 12px;
      right: 14px;
      background: none;
      border: none;
      font-size: 1.4rem;
      cursor: pointer;
    }
    /* Quote summary hidden section for email */
    #quote-summary {
      max-width: 900px;
      margin: 30px auto;
      background-color: #fff;
      border-radius: 12px;
      border: 1px solid #d7dfe8;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      padding: 24px;
      display: none;
    }
    #quote-summary.active {
      display: block;
    }
    #quote-summary h3 {
      color: #002c5f;
      margin-bottom: 12px;
      font-size: 1.4rem;
      font-weight: 600;
    }
    #quote-summary ul {
      list-style-type: disc;
      margin-left: 24px;
      margin-bottom: 12px;
      color: #333;
    }
    #quote-summary .totals span {
      display: block;
      font-weight: 600;
      color: #e01c2d;
      margin-bottom: 4px;
    }
    #quote-summary .actions {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    #quote-summary .actions button {
      flex: none;
      min-width: 180px;
      background-color: #06529c;
      color: #fff;
      border: none;
      padding: 12px 16px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.1s;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
    }
    #quote-summary .actions button:hover {
      background-color: #04417a;
      transform: translateY(-2px);
    }
    .actions .secondary {
      background-color: #e01c2d;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .actions .secondary:hover {
      background-color: #c21823;
    }

    /* Quote logo styling for summary page */
    .quote-logo {
      height: 60px;
      display: block;
      margin: 0 auto 12px;
    }

    /* Responsive adjustments for smaller screens */
    @media (max-width: 768px) {
      .top-bar {
        flex-direction: column;
        align-items: flex-start;
      }
      .top-bar .right {
        margin-top: 4px;
      }
      .categories-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 16px;
        padding: 20px 10px;
      }
      .category-card {
        min-height: 200px;
        padding: 20px 16px;
      }
      header {
        flex-direction: column;
        align-items: flex-start;
        padding: 10px 20px;
      }
      header h1 {
        margin-top: 8px;
      }
      .modal-content {
        width: 95%;
        padding: 16px;
      }
    }

    /* About section styling */
    #about-section {
      background-color: #f0f4fa;
      padding: 40px 20px;
      color: #002c5f;
    }
    #about-section .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    #about-section h2 {
      font-size: 1.8rem;
      margin-bottom: 16px;
      font-weight: 600;
    }
    #about-section p {
      font-size: 1rem;
      margin-bottom: 12px;
      line-height: 1.6;
    }

    /* Footer styling */
    footer {
      background-color: #002c5f;
      color: #fff;
      padding: 24px 20px;
    }
    footer .container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: flex-start;
      gap: 20px;
    }
    footer .footer-info {
      flex: 1 1 260px;
    }
    footer .footer-info h3 {
      font-size: 1.2rem;
      margin-bottom: 8px;
      font-weight: 600;
    }
    footer .footer-info p {
      font-size: 0.9rem;
      line-height: 1.4;
      margin-bottom: 4px;
    }
    footer .footer-info a {
      color: #a3c4e0;
      text-decoration: none;
    }
    footer .footer-info a:hover {
      text-decoration: underline;
    }
    footer .copyright {
      text-align: center;
      width: 100%;
      margin-top: 20px;
      font-size: 0.8rem;
      color: #a3c4e0;
    }

    /* New variant card style inspired by provided design */
    .variant-card-new {
      border: 1px solid #d7dfe8;
      border-radius: 12px;
      background-color: #fff;
      padding: 16px;
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .variant-card-new .icons-row {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 10px;
    }
    .variant-card-new .icons-row img {
      width: 36px;
      height: 36px;
    }
    /* Adjust coloured icon wrappers inside variant modal icons row */
    .variant-card-new .icons-row .icon-wrapper {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }
    .variant-card-new .icons-row .icon-wrapper img {
      width: 24px;
      height: 24px;
      filter: invert(1);
    }
    .variant-card-new .title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #002c5f;
      text-align: center;
      margin-bottom: 6px;
    }
    .variant-card-new .price-info {
      text-align: center;
      margin-bottom: 6px;
    }
    .variant-card-new .price-info .price {
      font-size: 1.4rem;
      color: #002c5f;
      font-weight: 700;
    }
    .variant-card-new .price-info .monthly {
      font-size: 0.85rem;
      color: #e01c2d;
      font-weight: 600;
      margin-top: 2px;
    }
    .variant-card-new .size-label {
      font-size: 0.85rem;
      color: #555;
      text-align: center;
      margin-bottom: 8px;
      font-style: italic;
    }
    .variant-card-new .components {
      font-size: 0.9rem;
      margin-bottom: 10px;
      color: #333;
    }
    .variant-card-new .components strong {
      display: block;
      margin-bottom: 4px;
      color: #002c5f;
      font-weight: 600;
    }
    .variant-card-new .components ul {
      list-style-type: disc;
      margin-left: 20px;
      margin-bottom: 0;
    }
    .variant-card-new .request-btn {
      background-color: #e01c2d;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 12px;
      font-size: 1rem;
      cursor: pointer;
      width: 100%;
      transition: background-color 0.2s;
    }
    .variant-card-new .request-btn:hover {
      background-color: #c21823;
    }

    /* Single variant card for selecting size and requesting quote (new design) */
    .variant-card-single {
      border: 1px solid #d7dfe8;
      border-radius: 12px;
      background-color: #fff;
      padding: 20px;
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .variant-card-single .price-box {
      background-color: #06529c;
      color: #fff;
      border-radius: 8px;
      padding: 16px;
      text-align: center;
      font-size: 1.5rem;
      font-weight: 700;
      margin-top: 12px;
    }
    .variant-card-single .price-box .label {
      font-size: 1rem;
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
    }
    .variant-card-single .monthly-box,
    .variant-card-single .care-box {
      background-color: #e01c2d;
      color: #fff;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      font-size: 0.9rem;
      font-weight: 600;
      margin-top: 8px;
    }
    .variant-card-single .select-container {
      /* Put select at the top of the card with a small bottom margin */
      margin: 0 0 12px 0;
    }
    .variant-card-single .select-container label {
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
      color: #002c5f;
    }
    .variant-card-single select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .variant-card-single .components {
      margin-top: 12px;
      font-size: 0.9rem;
    }
    .variant-card-single .components strong {
      display: block;
      margin-bottom: 4px;
      color: #002c5f;
      font-weight: 600;
    }
    .variant-card-single .components ul {
      list-style-type: disc;
      margin-left: 20px;
      margin-bottom: 0;
    }
    .variant-card-single .request-btn {
      margin-top: 16px;
      /* Use a green tone inspired by the Maple Air leaf for the Request Quote button */
      background-color: #009e60;
      color: #fff;
      border: none;
      padding: 12px;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .variant-card-single .request-btn:hover {
      background-color: #007a48;
    }

    /* Request form modal styles */
    .request-form-container {
      padding: 0;
    }
    .request-form-header {
      /* Use Maple Air dark blue for form header to match overall theme */
      background-color: #002c5f;
      color: #fff;
      padding: 12px 16px;
      border-radius: 12px 12px 0 0;
      font-size: 1.2rem;
      font-weight: 600;
    }
    .request-form-body {
      padding: 16px;
    }
    .request-form-body .info {
      margin-bottom: 12px;
      font-size: 0.95rem;
      color: #333;
    }
    .request-form-body .info .price {
      font-size: 1.3rem;
      color: #002c5f;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .request-form-body .info .monthly {
      font-size: 0.85rem;
      color: #e01c2d;
      font-weight: 600;
    }
    .request-form-body .info .size {
      font-size: 0.85rem;
      font-style: italic;
      color: #555;
      margin-bottom: 8px;
    }
    .request-form-body .components {
      margin-bottom: 12px;
    }
    .request-form-body .components strong {
      display: block;
      margin-bottom: 4px;
      color: #002c5f;
      font-weight: 600;
    }
    .request-form-body .components ul {
      list-style-type: disc;
      margin-left: 20px;
      font-size: 0.9rem;
    }
    .request-form-body .form-field {
      margin-bottom: 10px;
    }
    .request-form-body .form-field label {
      display: block;
      margin-bottom: 4px;
      font-size: 0.9rem;
      color: #002c5f;
    }
    .request-form-body .form-field input,
    .request-form-body .form-field textarea {
      width: 100%;
      padding: 6px 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 0.9rem;
    }
    .request-form-body .form-field textarea {
      resize: vertical;
      height: 80px;
    }
    .request-form-body .actions {
      margin-top: 12px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .request-form-body .actions button {
      flex: 1;
      border: none;
      border-radius: 4px;
      padding: 10px 14px;
      font-size: 0.9rem;
      cursor: pointer;
      color: #fff;
    }
    .request-form-body .actions .print-btn {
      background-color: #06529c;
    }
    .request-form-body .actions .print-btn:hover {
      background-color: #04417a;
    }
    .request-form-body .actions .email-btn {
      background-color: #e01c2d;
    }
    .request-form-body .actions .email-btn:hover {
      background-color: #c21823;
    }
    .request-form-body .actions .back-btn {
      background-color: #bbb;
      color: #333;
      flex: none;
    }
    .request-form-body .actions .back-btn:hover {
      background-color: #999;
    }

    /* Custom build unit selection grid */
    .unit-options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }
    .unit-option {
      border: 1px solid #d7dfe8;
      border-radius: 8px;
      padding: 12px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.2s ease, background-color 0.2s ease;
      background-color: #fff;
    }
    .unit-option:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.12);
    }
    .unit-option img {
      /* removed: using font-awesome icons instead */
    }
    .unit-option .price {
      font-size: 0.8rem;
      color: #555;
      margin-top: 4px;
    }
    .unit-option.selected {
      background-color: #013e7d;
      color: #fff;
      border-color: #06529c;
    }
    .unit-option.selected .price {
      color: #fff;
    }

    /* Font Awesome icon styling inside unit options */
    .unit-option i {
      font-size: 36px;
      margin-bottom: 8px;
      display: block;
    }
    .unit-option.selected i {
      color: #fff;
    }

    /* Adjust coloured icon wrappers inside custom build unit options */
    .unit-option .icon-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin: 0 auto 6px auto;
    }
    .unit-option .icon-wrapper img {
      width: 24px;
      height: 24px;
      filter: invert(1);
    }
  </style>
</head>
<body>
  <!-- Top bar removed: only phone number will be shown in header -->
  <header>
    <div class="header-left">
      <img src="logo.png" alt="Maple Air Logo" class="logo" />
      <h1>Home Comfort Packages</h1>
    </div>
    <span class="phone-badge">877‑780‑6667</span>
  </header>
  <main>
    <section class="categories-grid" id="categories-grid">
      <!-- Cards generated by JS -->
    </section>
  </main>
  <!-- Modal overlay for packages and custom build -->
  <div id="modal-overlay">
    <div class="modal-content">
      <button class="modal-close" id="modal-close">×</button>
      <div class="modal-title" id="modal-title"></div>
      <div class="modal-body" id="modal-body"></div>
    </div>

  </div>

  <!-- About Maple Air Section (outside modal) -->
  <section id="about-section">
    <div class="container">
      <h2>About Maple Air</h2>
      <p>For nearly two decades, Maple Air Inc. has grown into one of the Greater Toronto Area’s leading heating and cooling companies.  The company was built on a simple motto: <strong>customer satisfaction, quality workmanship and fast, reliable service</strong>.  Whether it’s a new installation or emergency repair, Maple Air’s professionals strive to help customers live more comfortable and healthy lives with fully licensed and factory‑trained technicians.</p>
      <p>Maple Air operates on guiding principles of valuing customers, honesty, quality service and professionalism.  This dedication has earned Maple Air recognition as one of the most trusted heating and cooling service companies in Toronto, offering 24‑hour emergency repairs, same‑day service and flat‑rate pricing with certified technicians.</p>
    </div>
  </section>

  <!-- Footer with Contact Information (outside modal) -->
  <footer>
    <div class="container">
      <div class="footer-info">
        <h3>Contact Us</h3>
        <p>Maple Air Inc.</p>
        <p>7581 Jane Street, Unit 10 &amp; 11<br/>Vaughan, ON L4K 1X3</p>
        <p>Toll‑free: <a href="tel:8777806667">877‑780‑6667</a></p>
        <p>Phone: <a href="tel:9054821833">905‑482‑1833</a></p>
        <p>Email: <a href="mailto:info@mapleair.com">info@mapleair.com</a></p>
      </div>
      <div class="footer-info">
        <h3>Our Commitment</h3>
        <p>We value every customer and stand behind our work. With honesty, professionalism and quality service, Maple Air’s team is ready to serve your home comfort needs.</p>
        <p><em>24‑hour emergency repairs and same‑day service available</em>.</p>
      </div>
    </div>
    <div class="copyright">&copy; <script>document.write(new Date().getFullYear());</script> Maple Air Inc.  All rights reserved.</div>
  </footer>
  <!-- Hidden quote summary section used for email output -->
  <section id="quote-summary">
    <img src="logo.png" alt="Maple Air Logo" class="quote-logo" />
    <h3 id="summary-title">Quote Summary</h3>
    <ul id="summary-units"></ul>
    <div class="totals" id="summary-totals"></div>
    <div class="actions">
      <button id="print-btn" class="secondary">Print Quote</button>
      <button id="email-btn" class="secondary">Send to Service</button>
    </div>
  </section>
  <script>
    // Package and unit data
    const initialData = {
      "packages": [
        {"name":"Eco Plus Package","variants":[{"size":"Eco Plus#1","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"}],"total_amount":10410.3195,"monthly_payment":131.6472598638002,"maple_care":158.63825986380022},{"size":"Eco Plus#2","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"}],"total_amount":10950.838499999998,"monthly_payment":138.48257795891928,"maple_care":165.4735779589193},{"size":"Eco Plus#3","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"}],"total_amount":10898.338499999998,"monthly_payment":137.8186712322478,"maple_care":164.8096712322478},{"size":"Eco Plus#4","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"}],"total_amount":11138.82,"monthly_payment":140.8597623844393,"maple_care":167.8507623844393},{"size":"Eco Plus#5","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"}],"total_amount":12336.47625,"monthly_payment":156.00513458663295,"maple_care":182.99613458663293}]},
        {"name":"Hybrid Package","variants":[{"size":"Hybrid#1","units":[{"name":"Furnace"},{"name":"Heat-Pump"},{"name":"Smart Thermostat"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":16593.279999999995,"monthly_payment":209.83662505102086,"maple_care":251.2166250510209},{"size":"Hybrid#2","units":[{"name":"Furnace"},{"name":"Heat-Pump"},{"name":"Smart Thermostat"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":16818.279999999999,"monthly_payment":212.0475267825928,"maple_care":253.4275267825928},{"size":"Hybrid#3","units":[{"name":"Furnace"},{"name":"Heat-Pump"},{"name":"Smart Thermostat"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":16592.7,"monthly_payment":209.82931645308675,"maple_care":251.20931645308677},{"size":"Hybrid#4","units":[{"name":"Furnace"},{"name":"Heat-Pump"},{"name":"Smart Thermostat"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":18229.139999999996,"monthly_payment":230.05613848451889,"maple_care":271.4361384845189},{"size":"Hybrid#5","units":[{"name":"Furnace"},{"name":"Heat-Pump"},{"name":"Smart Thermostat"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":18674.579999999994,"monthly_payment":235.24513197663455,"maple_care":276.6251319766345}]},
        {"name":"Platinum Package","variants":[{"size":"Platinum#1","units":[{"name":"Furnace"},{"name":"Heat-Pump"},{"name":"Infinity Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":28512.885,"monthly_payment":360.5704199172301,"maple_care":401.9504199172301},{"size":"Platinum#2","units":[{"name":"Furnace"},{"name":"Heat-Pump"},{"name":"Infinity Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":28969.584999999996,"monthly_payment":366.56845102858883,"maple_care":407.9484510285888},{"size":"Platinum#3","units":[{"name":"Furnace"},{"name":"Heat-Pump"},{"name":"Infinity Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":29105.924999999996,"monthly_payment":368.0743353032866,"maple_care":409.45433530328654},{"size":"Platinum#4","units":[{"name":"Furnace"},{"name":"Heat-Pump"},{"name":"Infinity Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":32027.964999999997,"monthly_payment":405.2219216696429,"maple_care":446.60192166964285},{"size":"Platinum#5","units":[{"name":"Furnace"},{"name":"Heat-Pump"},{"name":"Infinity Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":31964.595000000005,"monthly_payment":404.4926434079369,"maple_care":445.8726434079369}]},
        {"name":"Elite Package","variants":[{"size":"Elite#1","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Infinity Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":25963.0731,"monthly_payment":328.32614117052225,"maple_care":369.70614117052224},{"size":"Elite#2","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Infinity Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":26566.3635,"monthly_payment":335.1502444950155,"maple_care":376.5302444950155},{"size":"Elite#3","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Infinity Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":27409.2174,"monthly_payment":345.1151229823128,"maple_care":386.49512298231277},{"size":"Elite#4","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Infinity Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":29886.7911,"monthly_payment":376.06354298653735,"maple_care":417.44354298653734},{"size":"Elite#5","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Infinity Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":31674.5141,"monthly_payment":398.6957510884011,"maple_care":440.07575108840115},{"size":"Elite#6","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Infinity Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":31568.3036,"monthly_payment":397.2618128902599,"maple_care":438.64181289025994},{"size":"Elite#7","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Infinity Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":33202.3208,"monthly_payment":417.83050960468673,"maple_care":459.2105096046867}]},
        {"name":"Furnace Package","variants":[{"size":"Furnace#1","units":[{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"},{"name":"UV Light"},{"name":"Duct Cleaning"},{"name":"Ecobee Doorbell"}],"total_amount":6997.33,"monthly_payment":88.49987412973598,"maple_care":115.49087412973598},{"size":"Furnace#2","units":[{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"},{"name":"UV Light"},{"name":"Duct Cleaning"},{"name":"Ecobee Doorbell"}],"total_amount":7216.08,"monthly_payment":91.1056672124481,"maple_care":118.0966672124481},{"size":"Furnace#3","units":[{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"},{"name":"UV Light"},{"name":"Duct Cleaning"},{"name":"Ecobee Doorbell"}],"total_amount":7110.9088,"monthly_payment":89.86995318670172,"maple_care":116.86095318670171},{"size":"Furnace#4","units":[{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"},{"name":"UV Light"},{"name":"Duct Cleaning"},{"name":"Ecobee Doorbell"}],"total_amount":7809.584,"monthly_payment":98.32155342705345,"maple_care":125.31255342705344},{"size":"Furnace#5","units":[{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"},{"name":"UV Light"},{"name":"Duct Cleaning"},{"name":"Ecobee Doorbell"}],"total_amount":8560.224,"monthly_payment":107.00279918495239,"maple_care":134.9937991849524}]},
        {"name":"Infinity Package","variants":[{"size":"Infinity#1","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Smart Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":24993.39,"monthly_payment":316.0398799200214,"maple_care":357.4198799200214},{"size":"Infinity#2","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Smart Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":24993.39,"monthly_payment":316.0398799200214,"maple_care":357.4198799200214},{"size":"Infinity#3","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Smart Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":25662.39,"monthly_payment":324.39688735735294,"maple_care":365.77688735735295},{"size":"Infinity#4","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Smart Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":25983.39,"monthly_payment":328.52865654765244,"maple_care":369.9086565476524},{"size":"Infinity#5","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Smart Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":26652.39,"monthly_payment":336.88566398498305,"maple_care":378.265663984983},{"size":"Infinity#6","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Smart Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":27493.39,"monthly_payment":347.7185951715105,"maple_care":389.09859517151053},{"size":"Infinity#7","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Smart Thermostat"},{"name":"Steam Humidifier"},{"name":"Air Cleaner"},{"name":"Tankless"},{"name":"Ecobee Doorbell"}],"total_amount":28993.39,"monthly_payment":366.8667662906119,"maple_care":408.24676629061193}]},
        {"name":"Eco Package","variants":[{"size":"Eco#1","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"},{"name":"Ecobee Doorbell"},{"name":"UV Light"}],"total_amount":9759.32,"monthly_payment":123.41453508156346,"maple_care":164.80453508156347},{"size":"Eco#2","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"},{"name":"Ecobee Doorbell"},{"name":"UV Light"}],"total_amount":10593.32,"monthly_payment":133.8632024143635,"maple_care":175.25320241436347},{"size":"Eco#3","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"},{"name":"Ecobee Doorbell"},{"name":"UV Light"}],"total_amount":10733.32,"monthly_payment":135.43130265851698,"maple_care":176.82130265851698},{"size":"Eco#4","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"},{"name":"Ecobee Doorbell"},{"name":"UV Light"}],"total_amount":11493.32,"monthly_payment":144.86616645593063,"maple_care":186.25616645593065},{"size":"Eco#5","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"},{"name":"Ecobee Doorbell"},{"name":"UV Light"}],"total_amount":12793.32,"monthly_payment":161.5121627602231,"maple_care":202.9021627602231},{"size":"Eco#6","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"},{"name":"Ecobee Doorbell"},{"name":"UV Light"}],"total_amount":12532.36,"monthly_payment":158.52847949533613,"maple_care":199.91847949533614},{"size":"Eco#7","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"},{"name":"Ecobee Doorbell"},{"name":"UV Light"}],"total_amount":13685.45,"monthly_payment":173.2581112864576,"maple_care":214.6481112864576},{"size":"Eco#8","units":[{"name":"Air Conditioner"},{"name":"Furnace"},{"name":"Humidifier"},{"name":"Air Cleaner"},{"name":"Smart Thermostat"},{"name":"Ecobee Doorbell"},{"name":"UV Light"}],"total_amount":14565.520000000002,"monthly_payment":184.38959497403336,"maple_care":225.77959497403337}]}
      ],
      "units": [
        {"name":"Air Conditioner","category":"Unit","price":2368.28},
        {"name":"Furnace","category":"Unit","price":2289.77},
        {"name":"Humidifier","category":"Unit","price":1575.45},
        {"name":"Air Cleaner","category":"Unit","price":2289.77},
        {"name":"Smart Thermostat","category":"Unit","price":1926.1},
        {"name":"Heat-Pump","category":"Unit","price":2705.33},
        {"name":"Infinity Thermostat","category":"Unit","price":3162.57},
        {"name":"Steam Humidifier","category":"Unit","price":3093.38},
        {"name":"Tankless","category":"Service","price":2867.0},
        {"name":"Ecobee Doorbell","category":"Service","price":2310.96},
        {"name":"UV Light","category":"Service","price":2310.96},
        {"name":"Duct Cleaning","category":"Service","price":2310.96}
      ]
    };
  </script>
  <script>
    (function() {
      // Retrieve data from localStorage or fall back to initialData
      let data;
      const stored = localStorage.getItem('hvacData');
      if (stored) {
        try {
          data = JSON.parse(stored);
        } catch (e) {
          data = initialData;
        }
      } else {
        data = initialData;
        localStorage.setItem('hvacData', JSON.stringify(data));
      }
      // Build unit map with price and category information
      let unitMap = {};
      if (data.units) {
        data.units.forEach(u => {
          unitMap[u.name] = { ...u };
        });
      }
      // Ensure up-to-date price/category using initialData
      const initialUnitMap = {};
      initialData.units.forEach(u => {
        initialUnitMap[u.name] = { ...u };
      });
      Object.keys(initialUnitMap).forEach(name => {
        if (!unitMap[name]) {
          unitMap[name] = { ...initialUnitMap[name] };
        } else {
          if (!unitMap[name].price || unitMap[name].price === 0) {
            unitMap[name].price = initialUnitMap[name].price;
          }
          if (!unitMap[name].category) {
            unitMap[name].category = initialUnitMap[name].category;
          }
        }
      });
      // Override categories: tankless becomes Unit; accessories list; only Duct Cleaning remains Service
      const categoryOverrides = {
        'Tankless': 'Unit',
        'Ecobee Doorbell': 'Accessory',
        'Humidifier': 'Accessory',
        'Steam Humidifier': 'Accessory',
        'Air Cleaner': 'Accessory',
        'Smart Thermostat': 'Accessory',
        'Infinity Thermostat': 'Accessory',
        'UV Light': 'Accessory'
      };
      Object.keys(categoryOverrides).forEach(name => {
        if (unitMap[name]) {
          unitMap[name].category = categoryOverrides[name];
        }
      });
      // Size descriptors for package ranges
      const sizeDescriptors = {
        // Define four distinct categories for home sizes: small, medium, mid‑large and large.
        // Any size index above 4 is treated as large homes.
        1: 'small homes',
        2: 'medium homes',
        3: 'mid-large homes',
        4: 'large homes'
      };
      function getHouseSizeText(num) {
        /*
         * Translate a numeric variant index into a human‑friendly description of the recommended home size.
         * We consolidate all sizes into four buckets and clamp any larger value to the largest bucket.
         */
        const idx = Math.min(Math.max(num, 1), 4);
        switch (idx) {
          case 1:
            return 'Ideal for small homes (≤1,200 sq ft)';
          case 2:
            return 'Ideal for medium homes (~1,200–1,500 sq ft)';
          case 3:
            return 'Ideal for mid‑large homes (~1,500–1,800 sq ft)';
          case 4:
          default:
            return 'Ideal for large homes (≥1,800 sq ft)';
        }
      }
      // Icon mapping for unit names. Icons reside in the icons/ folder
      // Mapping of unit names to local PNG icons. These icons live in the "icons" folder so they can be easily replaced.
      const unitIcons = {
        'Air Conditioner': 'icons/air-conditioner-icon.png',
        'Furnace': 'icons/furnace-icon.png',
        'Heat-Pump': 'icons/heat-pump-icon.png',
        'Tankless': 'icons/tankless-icon.png',
        'Smart Thermostat': 'icons/thermostat-icon.png',
        'Infinity Thermostat': 'icons/thermostat-icon.png',
        // Reuse air conditioner icon as placeholder for humidifiers and air cleaners
        'Humidifier': 'icons/air-conditioner-icon.png',
        'Steam Humidifier': 'icons/air-conditioner-icon.png',
        'Air Cleaner': 'icons/air-conditioner-icon.png',
        // Reuse thermostat icon for UV lights, doorbells and duct cleaning
        'UV Light': 'icons/thermostat-icon.png',
        'Ecobee Doorbell': 'icons/thermostat-icon.png',
        'Duct Cleaning': 'icons/thermostat-icon.png'
      };
      // Mapping of unit names to circle background colours to make icons colourful and visually distinct
      const iconColors = {
        'Air Conditioner': '#00aaff', // blue
        'Furnace': '#e74c3c',        // red/orange
        'Heat-Pump': '#16a085',      // teal
        'Tankless': '#3498db',       // bright blue
        'Smart Thermostat': '#f39c12', // yellow
        'Infinity Thermostat': '#f39c12',
        'Humidifier': '#1abc9c',      // greenish teal
        'Steam Humidifier': '#1abc9c',
        'Air Cleaner': '#2ecc71',     // green
        'UV Light': '#9b59b6',        // purple
        'Ecobee Doorbell': '#e67e22', // orange
        'Duct Cleaning': '#8e44ad'    // violet
      };
      // DOM references
      const grid = document.getElementById('categories-grid');
      const modalOverlay = document.getElementById('modal-overlay');
      const modalTitle = document.getElementById('modal-title');
      const modalBody = document.getElementById('modal-body');
      const modalClose = document.getElementById('modal-close');
      const summarySection = document.getElementById('quote-summary');
      const summaryUnitsList = document.getElementById('summary-units');
      const summaryTotals = document.getElementById('summary-totals');
      const printBtn = document.getElementById('print-btn');
      const emailBtn = document.getElementById('email-btn');
      modalClose.addEventListener('click', () => {
        modalOverlay.classList.remove('active');
        modalBody.innerHTML = '';
      });
      let selectedUnits = [];
      let selectedVariant = null;
      let isCustom = false;
    // Track selected home size for custom build (1-5). If null, size not selected yet.
    let customHomeSize = null;
      // Track the package and variant being viewed in the modal
      let currentPackage = null;
      let currentVariantIndex = 0;
      // Build package cards
      data.packages.forEach(pkg => {
        const card = document.createElement('div');
        card.className = 'category-card';
        const nameEl = document.createElement('h2');
        nameEl.textContent = pkg.name;
        card.appendChild(nameEl);
        // Unique unit names across variants (only units)
        const uniqueUnits = [];
        pkg.variants.forEach(v => {
          v.units.forEach(u => {
            const cat = unitMap[u.name] ? unitMap[u.name].category : 'Unit';
            if (cat === 'Unit' && !uniqueUnits.includes(u.name)) {
              uniqueUnits.push(u.name);
            }
          });
        });
        if (uniqueUnits.length > 0) {
          const iconsRow = document.createElement('div');
          iconsRow.className = 'unit-icons';
          uniqueUnits.slice(0, 5).forEach(name => {
            // Create a coloured circular wrapper with the PNG icon inside
            const wrapper = document.createElement('span');
            wrapper.className = 'icon-wrapper';
            const color = iconColors[name] || '#002c5f';
            wrapper.style.backgroundColor = color;
            const imgEl = document.createElement('img');
            imgEl.src = unitIcons[name] || unitIcons['Smart Thermostat'];
            imgEl.alt = name + ' icon';
            imgEl.style.filter = 'invert(1)';
            wrapper.appendChild(imgEl);
            wrapper.setAttribute('title', name);
            iconsRow.appendChild(wrapper);
          });
          card.appendChild(iconsRow);
        }
        // Determine range of sizes across variants
        let minNum = Infinity;
        let maxNum = -Infinity;
        pkg.variants.forEach(v => {
          const parts = v.size.split('#');
          if (parts.length > 1) {
            const n = parseInt(parts[1]);
            if (!isNaN(n)) {
              if (n < minNum) minNum = n;
              if (n > maxNum) maxNum = n;
            }
          }
        });
        if (minNum === Infinity) {
          minNum = 1; maxNum = 5;
        }
        const minKey = Math.min(Math.max(minNum, 1), 4);
        const maxKey = Math.min(Math.max(maxNum, 1), 4);
        const minDesc = sizeDescriptors[minKey];
        const maxDesc = sizeDescriptors[maxKey];
        if (minDesc && maxDesc) {
          const sizeEl = document.createElement('div');
          sizeEl.className = 'package-size-range';
          if (minDesc === maxDesc) {
            sizeEl.textContent = minDesc.charAt(0).toUpperCase() + minDesc.slice(1);
          } else {
            sizeEl.textContent = minDesc.charAt(0).toUpperCase() + minDesc.slice(1) + ' – ' + maxDesc;
          }
          card.appendChild(sizeEl);
        }
        card.addEventListener('click', () => {
          openPackageModal(pkg);
        });
        grid.appendChild(card);
      });
      // Add custom build card
      const customCard = document.createElement('div');
      customCard.className = 'category-card';
      const cn = document.createElement('h2');
      cn.textContent = 'Custom Build';
      customCard.appendChild(cn);
      customCard.addEventListener('click', openCustomModal);
      grid.appendChild(customCard);
      // Open package modal
      function openPackageModal(pkg) {
        // Show a single card for the package with size selector and request button
        isCustom = false;
        selectedUnits = [];
        selectedVariant = null;
        currentPackage = pkg;
        modalTitle.textContent = pkg.name;
        modalBody.innerHTML = '';
        // Track current variant index
        let currentVariantIndex = 0;
        // Create card container
        const card = document.createElement('div');
        card.className = 'variant-card-single';
        // Remove the top icons row. We'll show icons only in front of each component below.
        // Price box (created here but will be appended later)
        const priceBox = document.createElement('div');
        priceBox.className = 'price-box';
        // Monthly payment box
        const monthlyBox = document.createElement('div');
        monthlyBox.className = 'monthly-box';
        // Maple care box
        const careBox = document.createElement('div');
        careBox.className = 'care-box';
        // We no longer show a separate size label element since size is indicated by the dropdown
        // Select container for choosing size (will be appended first)
        const selectDiv = document.createElement('div');
        selectDiv.className = 'select-container';
        const selectLbl = document.createElement('label');
        selectLbl.textContent = 'Select Size:';
        selectDiv.appendChild(selectLbl);
        const selectEl = document.createElement('select');
        /*
         * Build a mapping from consolidated size category (1–4) to a representative
         * variant index.  For each category we choose the variant with the
         * highest numerical suffix to better represent larger homes when
         * multiple variants fall into the same category.  Any category not
         * represented defaults to the last variant in the package.
         */
        const catVariantMap = {};
        const fallbackIdx = pkg.variants.length - 1;
        pkg.variants.forEach((v, idx) => {
          let n = 1;
          const parts = v.size.split('#');
          if (parts.length > 1) {
            const tmp = parseInt(parts[1]);
            if (!isNaN(tmp)) n = tmp;
          }
          const catIdx = Math.min(Math.max(n, 1), 4);
          const existingIdx = catVariantMap[catIdx];
          if (existingIdx === undefined) {
            catVariantMap[catIdx] = idx;
          } else {
            // Prefer the variant with the larger numeric suffix
            const existingNum = (() => {
              const p = pkg.variants[existingIdx].size.split('#');
              if (p.length > 1) {
                const tmp2 = parseInt(p[1]);
                return isNaN(tmp2) ? 0 : tmp2;
              }
              return 0;
            })();
            if (n > existingNum) {
              catVariantMap[catIdx] = idx;
            }
          }
        });
        // Create four options for categories 1–4
        for (let cat = 1; cat <= 4; cat++) {
          const idx = catVariantMap.hasOwnProperty(cat) ? catVariantMap[cat] : fallbackIdx;
          const opt = document.createElement('option');
          opt.value = idx;
          opt.textContent = getHouseSizeText(cat);
          if (cat === 1) opt.selected = true;
          selectEl.appendChild(opt);
        }
        selectEl.addEventListener('change', e => {
          currentVariantIndex = parseInt(e.target.value);
          updateCard();
        });
        selectDiv.appendChild(selectEl);
        // Components section container (will include categories)
        const componentsDiv = document.createElement('div');
        componentsDiv.className = 'components';
        // Request button
        const reqBtn = document.createElement('button');
        reqBtn.className = 'request-btn';
        // Build card by appending elements in the desired order:
        // 1. size selector
        card.appendChild(selectDiv);
        // 2. components list (with icons)
        card.appendChild(componentsDiv);
        // 3. price boxes
        card.appendChild(priceBox);
        card.appendChild(monthlyBox);
        card.appendChild(careBox);
        // 4. request button
        card.appendChild(reqBtn);
        // Function to update card content based on currentVariantIndex
        function updateCard() {
          const variant = pkg.variants[currentVariantIndex];
          // Update price box
          priceBox.innerHTML = '';
          const priceLabelSpan = document.createElement('span');
          priceLabelSpan.className = 'label';
          priceLabelSpan.textContent = 'Price';
          priceBox.appendChild(priceLabelSpan);
          const priceValueSpan = document.createElement('span');
          priceValueSpan.textContent = '$' + Math.round(variant.total_amount).toLocaleString();
          priceBox.appendChild(priceValueSpan);
          // Update monthly box
          monthlyBox.innerHTML = '180 Month Payment Plan <br>$' + Number(variant.monthly_payment).toFixed(0) + ' /month';
          // Update care box
          careBox.innerHTML = 'Maple Care Included <br>$' + Number(variant.maple_care).toFixed(0) + ' /month';
          // Build components list with categories (Units, Accessories, Services)
          componentsDiv.innerHTML = '';
          const compStrong = document.createElement('strong');
          compStrong.textContent = 'System Components:';
          componentsDiv.appendChild(compStrong);
          // Categorize items
          const unitNames = [];
          const accessoryNames = [];
          const serviceNames = [];
          variant.units.forEach(u => {
            const uname = u.name;
            const cat = unitMap[uname] ? unitMap[uname].category : 'Unit';
            if (cat === 'Unit') unitNames.push(uname);
            else if (cat === 'Accessory') accessoryNames.push(uname);
            else serviceNames.push(uname);
          });
          const categories = [
            { title: 'Units', items: unitNames },
            { title: 'Accessories', items: accessoryNames },
            { title: 'Services', items: serviceNames }
          ];
          categories.forEach(cat => {
            if (cat.items.length > 0) {
              // Category title
              const catTitle = document.createElement('div');
              catTitle.style.marginTop = '6px';
              catTitle.style.fontWeight = '600';
              catTitle.style.color = '#002c5f';
              catTitle.textContent = cat.title;
              componentsDiv.appendChild(catTitle);
              // Create a list for this category
              const ul = document.createElement('ul');
              cat.items.forEach(name => {
                const li = document.createElement('li');
                li.style.display = 'flex';
                li.style.alignItems = 'center';
                // Icon wrapper
                const iconWrap = document.createElement('span');
                iconWrap.style.display = 'inline-flex';
                iconWrap.style.alignItems = 'center';
                iconWrap.style.justifyContent = 'center';
                iconWrap.style.width = '24px';
                iconWrap.style.height = '24px';
                iconWrap.style.borderRadius = '50%';
                iconWrap.style.marginRight = '6px';
                const clr = iconColors[name] || '#002c5f';
                iconWrap.style.backgroundColor = clr;
                const img = document.createElement('img');
                img.src = unitIcons[name] || unitIcons['Smart Thermostat'];
                img.alt = name + ' icon';
                img.style.width = '14px';
                img.style.height = '14px';
                img.style.filter = 'invert(1)';
                iconWrap.appendChild(img);
                li.appendChild(iconWrap);
                // Text
                const nameSpan = document.createElement('span');
                nameSpan.textContent = name;
                li.appendChild(nameSpan);
                ul.appendChild(li);
              });
              componentsDiv.appendChild(ul);
            }
          });
          // Update request button text using currently selected option text
          const selectedLabel = selectEl.options[selectEl.selectedIndex] ? selectEl.options[selectEl.selectedIndex].textContent : '';
          reqBtn.textContent = 'Request Quote for ' + selectedLabel;
        }
        // Request button click
        reqBtn.addEventListener('click', () => {
          const variant = pkg.variants[currentVariantIndex];
          isCustom = false;
          selectedVariant = variant;
          selectedUnits = variant.units.map(u => u.name);
          openRequestForm(pkg, variant);
        });
        // Initial update
        updateCard();
        // Append card to modal body
        modalBody.appendChild(card);
        // Show modal
        modalOverlay.classList.add('active');
      }
      // Custom build modal
      function openCustomModal() {
        isCustom = true;
        selectedUnits = [];
        selectedVariant = null;
        modalTitle.textContent = 'Custom Build';
        modalBody.innerHTML = '';
        // Reset custom home size
        customHomeSize = null;
        // Predeclare variables used across this function for scope
        let gridContainer;
        let calcCustomBtn;
        // Create container for size selection
        const sizeDiv = document.createElement('div');
        sizeDiv.style.marginBottom = '12px';
        const sizeLabel = document.createElement('label');
        sizeLabel.textContent = 'Select Home Size:';
        sizeLabel.style.display = 'block';
        sizeLabel.style.marginBottom = '4px';
        sizeDiv.appendChild(sizeLabel);
        const sizeSelect = document.createElement('select');
        sizeSelect.style.width = '100%';
        sizeSelect.style.padding = '8px';
        sizeSelect.style.border = '1px solid #ccc';
        sizeSelect.style.borderRadius = '4px';
        // placeholder option
        const placeholderOpt = document.createElement('option');
        placeholderOpt.value = '';
        placeholderOpt.textContent = '-- Select size --';
        placeholderOpt.disabled = true;
        placeholderOpt.selected = true;
        sizeSelect.appendChild(placeholderOpt);
        // Add options for each size category 1–4 (large homes covers sizes ≥4)
        for (let i = 1; i <= 4; i++) {
          const opt = document.createElement('option');
          opt.value = i;
          opt.textContent = getHouseSizeText(i);
          sizeSelect.appendChild(opt);
        }
        sizeSelect.addEventListener('change', (e) => {
          const val = e.target.value;
          customHomeSize = val ? parseInt(val) : null;
          // Enable or disable grid and button based on size selection
          if (customHomeSize) {
            // show grid container
            gridContainer.style.display = '';
            calcCustomBtn.disabled = false;
            calcCustomBtn.style.opacity = '1';
          } else {
            gridContainer.style.display = 'none';
            calcCustomBtn.disabled = true;
            calcCustomBtn.style.opacity = '0.6';
          }
        });
        sizeDiv.appendChild(sizeSelect);
        modalBody.appendChild(sizeDiv);
        // Create a grid of unit options instead of checkboxes
        const unitsArray = Object.keys(unitMap).map(name => unitMap[name]);
        // Sort by category then name for grouping
        unitsArray.sort((a,b) => {
          if (a.category === b.category) return a.name.localeCompare(b.name);
          return a.category.localeCompare(b.category);
        });
        // Create container and grid for unit options
        gridContainer = document.createElement('div');
        const grid = document.createElement('div');
        grid.className = 'unit-options-grid';
        unitsArray.forEach(unit => {
          const option = document.createElement('div');
          option.className = 'unit-option';
          option.dataset.name = unit.name;
          // Create coloured circular wrapper with the PNG icon inside
          const wrapper = document.createElement('span');
          wrapper.className = 'icon-wrapper';
          const bgColor = iconColors[unit.name] || '#002c5f';
          wrapper.style.backgroundColor = bgColor;
          const imgIcon = document.createElement('img');
          imgIcon.src = unitIcons[unit.name] || unitIcons['Smart Thermostat'];
          imgIcon.alt = unit.name + ' icon';
          imgIcon.style.filter = 'invert(1)';
          wrapper.appendChild(imgIcon);
          option.appendChild(wrapper);
          // Name
          const nameEl = document.createElement('div');
          nameEl.textContent = unit.name;
          option.appendChild(nameEl);
          // Price
          const priceEl = document.createElement('div');
          priceEl.className = 'price';
          priceEl.textContent = unit.price ? '$' + unit.price.toFixed(2) : '';
          option.appendChild(priceEl);
          // Click handler to toggle selection
          option.addEventListener('click', () => {
            // Only allow selection if home size chosen
            if (!customHomeSize) {
              alert('Please select a home size first.');
              return;
            }
            const idx = selectedUnits.indexOf(unit.name);
            if (idx >= 0) {
              // deselect
              selectedUnits.splice(idx, 1);
              option.classList.remove('selected');
            } else {
              selectedUnits.push(unit.name);
              option.classList.add('selected');
            }
          });
          grid.appendChild(option);
        });
        gridContainer.appendChild(grid);
        modalBody.appendChild(gridContainer);
        // initially hide grid until size selected
        gridContainer.style.display = 'none';
        // Button to calculate custom quote
        calcCustomBtn = document.createElement('button');
        calcCustomBtn.textContent = 'Calculate Quote';
        calcCustomBtn.style.marginTop = '12px';
        calcCustomBtn.style.padding = '10px 14px';
        calcCustomBtn.style.backgroundColor = '#e01c2d';
        calcCustomBtn.style.color = '#fff';
        calcCustomBtn.style.border = 'none';
        calcCustomBtn.style.borderRadius = '4px';
        calcCustomBtn.style.cursor = 'pointer';
        // disabled until size selected
        calcCustomBtn.disabled = true;
        calcCustomBtn.style.opacity = '0.6';
        calcCustomBtn.addEventListener('click', () => {
          if (!customHomeSize) {
            alert('Please select a home size.');
            return;
          }
          if (selectedUnits.length === 0) {
            alert('Please select at least one unit.');
            return;
          }
          // Build a pseudo variant object for custom quote using selected size
          const totals = calculateCustomTotals();
          const pseudoVariant = {
            size: 'Custom#' + customHomeSize,
            units: selectedUnits.map(name => ({ name })),
            total_amount: totals.total,
            monthly_payment: totals.monthly,
            maple_care: totals.care
          };
          // Custom package object
          const customPkg = { name: 'Custom Build', variants: [pseudoVariant] };
          // Flag as custom
          isCustom = true;
          // Open request form for custom build
          openRequestForm(customPkg, pseudoVariant);
        });
        modalBody.appendChild(calcCustomBtn);
        modalOverlay.classList.add('active');
        summarySection.classList.remove('active');
      }

      // Open request form for a selected package variant
      function openRequestForm(pkg, variant) {
        // Update modal title
        modalTitle.textContent = 'Request Quote for ' + pkg.name;
        // Clear modal body
        modalBody.innerHTML = '';
        // Create form container
        const container = document.createElement('div');
        container.className = 'request-form-container';
        // Header
        const header = document.createElement('div');
        header.className = 'request-form-header';
        header.textContent = 'Request Quote for ' + pkg.name;
        container.appendChild(header);
        // Body
        const formBody = document.createElement('div');
        formBody.className = 'request-form-body';
        // Info section
        const info = document.createElement('div');
        info.className = 'info';
        // Price
        const priceSpan = document.createElement('div');
        priceSpan.className = 'price';
        priceSpan.textContent = '$' + Math.round(variant.total_amount).toLocaleString();
        info.appendChild(priceSpan);
        // Monthly payment information
        const monthlySpan = document.createElement('div');
        monthlySpan.className = 'monthly';
        monthlySpan.textContent = 'Financing available at $' + Number(variant.monthly_payment).toFixed(0) + '/month';
        info.appendChild(monthlySpan);
        // Maple Care price per month (MC) – show when available
        const careSpan = document.createElement('div');
        careSpan.className = 'monthly';
        careSpan.textContent = 'Maple Care Included at $' + Number(variant.maple_care).toFixed(0) + '/month';
        info.appendChild(careSpan);
        // Selected size descriptor
        const sizeSpan = document.createElement('div');
        sizeSpan.className = 'size';
        // compute size descriptor
        let varNum = 4;
        const parts = variant.size.split('#');
        if (parts.length > 1) {
          const n = parseInt(parts[1]);
          if (!isNaN(n)) varNum = Math.min(Math.max(n, 1), 4);
        }
        sizeSpan.textContent = 'Selected Size: ' + getHouseSizeText(varNum);
        info.appendChild(sizeSpan);
        formBody.appendChild(info);
        // Components section
        const comp = document.createElement('div');
        comp.className = 'components';
        const compStrong = document.createElement('strong');
        compStrong.textContent = 'Components:';
        comp.appendChild(compStrong);
        const compUl = document.createElement('ul');
        // categorize units into list
        const unitsList = [];
        const accessoriesList = [];
        const servicesList = [];
        variant.units.forEach(u => {
          const uname = u.name;
          const cat = unitMap[uname] ? unitMap[uname].category : 'Unit';
          if (cat === 'Unit') unitsList.push(uname);
          else if (cat === 'Accessory') accessoriesList.push(uname);
          else servicesList.push(uname);
        });
        // Build list items with icons for each component (units, accessories, services)
        unitsList.concat(accessoriesList, servicesList).forEach(name => {
          const li = document.createElement('li');
          li.style.display = 'flex';
          li.style.alignItems = 'center';
          // Create small icon wrapper
          const iconWrap = document.createElement('span');
          iconWrap.style.display = 'inline-flex';
          iconWrap.style.alignItems = 'center';
          iconWrap.style.justifyContent = 'center';
          iconWrap.style.width = '24px';
          iconWrap.style.height = '24px';
          iconWrap.style.borderRadius = '50%';
          iconWrap.style.marginRight = '6px';
          const colour = iconColors[name] || '#002c5f';
          iconWrap.style.backgroundColor = colour;
          const imgEl = document.createElement('img');
          imgEl.src = unitIcons[name] || unitIcons['Smart Thermostat'];
          imgEl.alt = name + ' icon';
          imgEl.style.width = '14px';
          imgEl.style.height = '14px';
          imgEl.style.filter = 'invert(1)';
          iconWrap.appendChild(imgEl);
          li.appendChild(iconWrap);
          const textEl = document.createElement('span');
          textEl.textContent = name;
          li.appendChild(textEl);
          compUl.appendChild(li);
        });
        comp.appendChild(compUl);
        formBody.appendChild(comp);
        // Form fields
        const fields = [
          { id: 'firstName', label: 'First Name', type: 'text' },
          { id: 'lastName', label: 'Last Name', type: 'text' },
          { id: 'phone', label: 'Phone Number', type: 'tel' },
          { id: 'address', label: 'Address', type: 'text' },
          { id: 'city', label: 'City', type: 'text' },
          { id: 'postalCode', label: 'Postal Code', type: 'text' },
          { id: 'email', label: 'Email', type: 'email' }
        ];
        fields.forEach(f => {
          const fieldDiv = document.createElement('div');
          fieldDiv.className = 'form-field';
          const label = document.createElement('label');
          label.setAttribute('for', f.id);
          label.textContent = f.label;
          fieldDiv.appendChild(label);
          const input = document.createElement('input');
          input.type = f.type;
          input.id = f.id;
          fieldDiv.appendChild(input);
          formBody.appendChild(fieldDiv);
        });
        // Occupancy radio group
        const occField = document.createElement('div');
        occField.className = 'form-field';
        const occLabel = document.createElement('label');
        occLabel.textContent = 'Occupancy Status';
        occField.appendChild(occLabel);
        const radioGroup = document.createElement('div');
        radioGroup.className = 'radio-group';
        const ownerLabel = document.createElement('label');
        const ownerInput = document.createElement('input');
        ownerInput.type = 'radio';
        ownerInput.name = 'occupancy';
        ownerInput.value = 'Homeowner';
        ownerLabel.appendChild(ownerInput);
        ownerLabel.appendChild(document.createTextNode(' Homeowner'));
        radioGroup.appendChild(ownerLabel);
        const tenantLabel = document.createElement('label');
        const tenantInput = document.createElement('input');
        tenantInput.type = 'radio';
        tenantInput.name = 'occupancy';
        tenantInput.value = 'Tenant';
        tenantLabel.appendChild(tenantInput);
        tenantLabel.appendChild(document.createTextNode(' Tenant'));
        radioGroup.appendChild(tenantLabel);
        occField.appendChild(radioGroup);
        formBody.appendChild(occField);
        // Approval checkbox
        const approveDiv = document.createElement('div');
        approveDiv.className = 'form-field';
        const approveLabel = document.createElement('label');
        const approveInput = document.createElement('input');
        approveInput.type = 'checkbox';
        approveInput.id = 'infoApproval';
        approveLabel.appendChild(approveInput);
        approveLabel.appendChild(document.createTextNode(' I confirm that the information above is accurate.'));
        approveDiv.appendChild(approveLabel);
        formBody.appendChild(approveDiv);
        // Terms and conditions
        const termsDiv = document.createElement('div');
        termsDiv.className = 'terms';
        termsDiv.innerHTML = '<strong>Terms and Conditions:</strong> All quotes are estimates and subject to in-home inspection, availability of equipment and applicable taxes. Financing options and monthly payment amounts are contingent upon credit approval. Maple Air reserves the right to modify pricing and packages without notice. By proceeding you acknowledge that you have read and understood these terms.';
        formBody.appendChild(termsDiv);
        // Actions row
        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'actions';
        // Print button
        const pBtn = document.createElement('button');
        pBtn.className = 'print-btn';
        pBtn.textContent = 'Print Request';
        pBtn.addEventListener('click', () => {
          printRequest(pkg, variant);
        });
        actionsDiv.appendChild(pBtn);
        // Email button
        const eBtn = document.createElement('button');
        eBtn.className = 'email-btn';
        eBtn.textContent = 'Email Request';
        eBtn.addEventListener('click', () => {
          emailRequest(pkg, variant);
        });
        actionsDiv.appendChild(eBtn);
        // Back button
        const bBtn = document.createElement('button');
        bBtn.className = 'back-btn';
        bBtn.textContent = 'Back';
        bBtn.addEventListener('click', () => {
          // reopen the package selection modal
          openPackageModal(pkg);
        });
        actionsDiv.appendChild(bBtn);
        formBody.appendChild(actionsDiv);
        container.appendChild(formBody);
        modalBody.appendChild(container);
      }

      // Print the quote request on one page
      function printRequest(pkg, variant) {
        // Gather form values
        const getVal = id => {
          const el = modalBody.querySelector('#' + id);
          return el ? el.value.trim() : '';
        };
        const firstName = getVal('firstName');
        const lastName = getVal('lastName');
        const phone = getVal('phone');
        const address = getVal('address');
        const city = getVal('city');
        const postal = getVal('postalCode');
        const email = getVal('email');
        const occInput = modalBody.querySelector('input[name="occupancy"]:checked');
        const occupancy = occInput ? occInput.value : '';
        const approve = modalBody.querySelector('#infoApproval');
        // Build printable HTML
        let html = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Quote Request</title>';
        html += '<style>' +
          'body{font-family: Arial, Helvetica, sans-serif; padding:20px; background-color:#fff; color:#333;}' +
          'h2{color:#002c5f; margin-bottom:10px;}' +
          'h3{color:#002c5f; margin-top:20px; margin-bottom:6px; font-size:1.2rem;}' +
          'ul{list-style-type:disc; margin-left:20px; margin-bottom:8px;}' +
          'li{margin-bottom:4px;}' +
          '.totals span{display:block; font-weight:600; color:#e01c2d; margin-bottom:4px;}' +
          '.customer-info span{display:block; margin-bottom:4px;}' +
          '.terms{font-size:0.8rem; color:#555; margin-top:18px;}' +
          'footer{margin-top:30px; text-align:center;}' +
          'footer img{height:50px;}' +
          '@media print{ body{ margin:0.5in; } h2,h3,ul,.totals,.customer-info,.terms,footer{ page-break-inside: avoid; } }' +
          '</style></head><body>';
        html += '<h2>' + pkg.name + ' Quote Request</h2>';
        // List selected units
        html += '<h3>Selected Components</h3><ul>';
        const unitsList = [];
        const accessoriesList = [];
        const servicesList = [];
        variant.units.forEach(u => {
          const uname = u.name;
          const cat = unitMap[uname] ? unitMap[uname].category : 'Unit';
          if (cat === 'Unit') unitsList.push(uname);
          else if (cat === 'Accessory') accessoriesList.push(uname);
          else servicesList.push(uname);
        });
        unitsList.concat(accessoriesList, servicesList).forEach(name => {
          html += '<li>' + name + '</li>';
        });
        html += '</ul>';
        // Totals
        html += '<div class="totals">';
        html += '<span>Total Amount: $' + variant.total_amount.toFixed(2) + '</span>';
        html += '<span>180 Monthly Payment Plan: $' + variant.monthly_payment.toFixed(2) + ' /month</span>';
        html += '<span>Maple Care Included: $' + variant.maple_care.toFixed(2) + ' /month</span>';
        html += '</div>';
        // Customer information
        html += '<h3>Customer Information</h3><div class="customer-info">';
        if (firstName || lastName) html += '<span>Name: ' + firstName + ' ' + lastName + '</span>';
        if (phone) html += '<span>Phone: ' + phone + '</span>';
        if (address) html += '<span>Address: ' + address + '</span>';
        if (city || postal) html += '<span>City/Postal: ' + city + (postal ? ', ' + postal : '') + '</span>';
        if (email) html += '<span>Email: ' + email + '</span>';
        if (occupancy) html += '<span>Occupancy: ' + occupancy + '</span>';
        html += '</div>';
        // Terms
        html += '<div class="terms"><strong>Terms and Conditions:</strong> All quotes are estimates and subject to in-home inspection, availability of equipment and applicable taxes. Financing options and monthly payment amounts are contingent upon credit approval. Maple Air reserves the right to modify pricing and packages without notice. By proceeding you acknowledge that you have read and understood these terms.</div>';
        // Footer logo
        html += '<footer><img src="logo.png" alt="Maple Air Logo"></footer>';
        html += '</body></html>';
        const win = window.open('', '_blank');
        win.document.write(html);
        win.document.close();
        win.focus();
        win.print();
      }

      // Email the quote request to sepehr@mapleair.com
      function emailRequest(pkg, variant) {
        // Gather form values
        const getVal = id => {
          const el = modalBody.querySelector('#' + id);
          return el ? el.value.trim() : '';
        };
        const firstName = getVal('firstName');
        const lastName = getVal('lastName');
        const phone = getVal('phone');
        const address = getVal('address');
        const city = getVal('city');
        const postal = getVal('postalCode');
        const email = getVal('email');
        const occInput = modalBody.querySelector('input[name="occupancy"]:checked');
        const occupancy = occInput ? occInput.value : '';
        const lines = [];
        lines.push('Quote Request for ' + pkg.name);
        // Selected units
        lines.push('Selected Components:');
        const unitsList = [];
        const accessoriesList = [];
        const servicesList = [];
        variant.units.forEach(u => {
          const uname = u.name;
          const cat = unitMap[uname] ? unitMap[uname].category : 'Unit';
          if (cat === 'Unit') unitsList.push(uname);
          else if (cat === 'Accessory') accessoriesList.push(uname);
          else servicesList.push(uname);
        });
        unitsList.concat(accessoriesList, servicesList).forEach(name => {
          lines.push('- ' + name);
        });
        lines.push('');
        // Totals
        lines.push('Total Amount: $' + variant.total_amount.toFixed(2));
        lines.push('180 Monthly Payment Plan: $' + variant.monthly_payment.toFixed(2) + '/month');
        lines.push('Maple Care Included: $' + variant.maple_care.toFixed(2) + '/month');
        lines.push('');
        // Customer info
        lines.push('Customer Information:');
        if (firstName || lastName) lines.push('Name: ' + firstName + ' ' + lastName);
        if (phone) lines.push('Phone: ' + phone);
        if (address) lines.push('Address: ' + address);
        if (city || postal) lines.push('City/Postal: ' + city + (postal ? ', ' + postal : ''));
        if (email) lines.push('Email: ' + email);
        if (occupancy) lines.push('Occupancy: ' + occupancy);
        lines.push('');
        // Terms summary
        lines.push('I confirm that the information provided is accurate and understand the terms and conditions.');
        const subject = encodeURIComponent('Home Comfort Quote Request - ' + pkg.name);
        const body = encodeURIComponent(lines.join('\n'));
        // Use sepehr email address as requested
        window.location.href = 'mailto:sepehr@mapleair.com?subject=' + subject + '&body=' + body;
      }
      // Calculate totals for custom builds
      function calculateCustomTotals() {
        let total = 0;
        selectedUnits.forEach(name => {
          const unit = unitMap[name];
          if (unit) total += unit.price || 0;
        });
        const monthly = total / 180;
        const care = monthly * 1.2;
        return { total, monthly, care };
      }
      // Update hidden summary section (for email) with current selection
      function updateSummary() {
        summaryUnitsList.innerHTML = '';
        summaryTotals.innerHTML = '';
        if (isCustom) {
          selectedUnits.forEach(name => {
            const li = document.createElement('li');
            li.textContent = name + (unitMap[name] && unitMap[name].price ? ` ($${unitMap[name].price.toFixed(2)})` : '');
            summaryUnitsList.appendChild(li);
          });
          const totals = calculateCustomTotals();
          summaryTotals.innerHTML = `<span>Total Amount: $${totals.total.toFixed(2)}</span><span>180 Monthly Payment Plan: $${totals.monthly.toFixed(2)} /month</span><span>Maple Care Included: $${totals.care.toFixed(2)} /month</span>`;
        } else if (selectedVariant) {
          selectedVariant.units.forEach(u => {
            const li = document.createElement('li');
            li.textContent = u.name;
            summaryUnitsList.appendChild(li);
          });
          summaryTotals.innerHTML = `<span>Total Amount: $${selectedVariant.total_amount.toFixed(2)}</span><span>180 Monthly Payment Plan: $${selectedVariant.monthly_payment.toFixed(2)} /month</span><span>Maple Care Included: $${selectedVariant.maple_care.toFixed(2)} /month</span>`;
        }
      }
      // Open summary popup with terms and print button
      function openSummaryWindow() {
        let html = '<!DOCTYPE html><html><head><title>Quote Summary</title><meta charset="UTF-8" />';
        // Add page styling including form elements and layout
        html += '<style>' +
          'body{font-family: Arial, Helvetica, sans-serif; padding:30px; background-color:#f7f9fc; color:#333; line-height:1.5;}' +
          'h2{color:#002c5f; margin-bottom:12px;}' +
          'h3{color:#002c5f; margin-top:24px; margin-bottom:8px; font-size:1.2rem;}' +
          'ul{list-style-type:disc; margin-left:20px; margin-bottom:12px;}' +
          'li{margin-bottom:4px;}' +
          '.totals span{display:block; font-weight:600; color:#e01c2d; margin-bottom:4px;}' +
          '.customer-form{margin-top:20px;}' +
          '.customer-form label{display:block; margin-bottom:8px; font-size:0.9rem; color:#333;}' +
          '.customer-form input[type="text"], .customer-form input[type="email"], .customer-form input[type="tel"]{width:100%; padding:6px 8px; border:1px solid #ccc; border-radius:4px; margin-top:4px;}' +
          '.customer-form .radio-group{margin:8px 0;}' +
          '.customer-form .radio-group label{margin-right:16px;}' +
          '.customer-form .approve{margin-top:12px; display:block; font-size:0.85rem; color:#333;}' +
          '.terms{font-size:0.8rem; color:#555; margin-top:20px;}' +
          '.print-btn{background-color:#06529c; color:#fff; border:none; padding:10px 14px; border-radius:4px; cursor:pointer; font-size:0.9rem; margin-top:20px;}' +
          'footer{margin-top:40px; text-align:center;}' +
          'footer img{height:50px;}' +
          '' +
          '@media print { body{ margin:10mm; } h2,h3,ul,.totals,.customer-form,.terms,footer{ page-break-inside: avoid; } }' +
        '</style></head><body>';
        // Add Maple Air logo at top, bigger than in footer
        html += '<div style="text-align:center;margin-bottom:20px;"><img src="logo.png" alt="Maple Air Logo" style="height:80px;" /></div>';
        html += '<h2>Quote Summary</h2>';
        // Build the list of selected units and compute totals
        let listItems = [];
        let totalsObj = null;
        if (isCustom) {
          selectedUnits.forEach(name => {
            const pricePart = (unitMap[name] && unitMap[name].price ? ' ($' + unitMap[name].price.toFixed(2) + ')' : '');
            listItems.push(name + pricePart);
          });
          totalsObj = calculateCustomTotals();
        } else if (selectedVariant) {
          selectedVariant.units.forEach(u => {
            listItems.push(u.name);
          });
          totalsObj = {
            total: selectedVariant.total_amount,
            monthly: selectedVariant.monthly_payment,
            care: selectedVariant.maple_care
          };
        }
        if (listItems.length > 0) {
          html += '<ul>';
          listItems.forEach(item => {
            html += '<li>' + item + '</li>';
          });
          html += '</ul>';
          html += '<div class="totals">';
          if (totalsObj) {
            html += '<span>Total Amount: $' + totalsObj.total.toFixed(2) + '</span>';
            html += '<span>180 Monthly Payment Plan: $' + totalsObj.monthly.toFixed(2) + ' /month</span>';
            html += '<span>Maple Care Included: $' + totalsObj.care.toFixed(2) + ' /month</span>';
          }
          html += '</div>';
        } else {
          html += '<p>No selection made.</p>';
        }
        // Add customer information form
        html += '<div class="customer-form">';
        html += '<h3>Customer Information</h3>';
        html += '<label>First Name:<br><input type="text" name="firstName" /></label>';
        html += '<label>Last Name:<br><input type="text" name="lastName" /></label>';
        html += '<label>Phone Number:<br><input type="tel" name="phone" /></label>';
        html += '<label>Address:<br><input type="text" name="address" /></label>';
        html += '<label>City:<br><input type="text" name="city" /></label>';
        html += '<label>Postal Code:<br><input type="text" name="postalCode" /></label>';
        html += '<label>Email:<br><input type="email" name="email" /></label>';
        // Occupancy radio buttons
        html += '<div class="radio-group">';
        html += '<label><input type="radio" name="occupancy" value="Homeowner" /> Homeowner</label>';
        html += '<label><input type="radio" name="occupancy" value="Tenant" /> Tenant</label>';
        html += '</div>';
        // Approval checkbox
        html += '<label class="approve"><input type="checkbox" name="infoApproval" /> I confirm that the information above is accurate.</label>';
        html += '</div>';
        // Terms and conditions section
        html += '<div class="terms"><strong>Terms and Conditions:</strong> All quotes are estimates and subject to in-home inspection, availability of equipment and applicable taxes. Financing options and monthly payment amounts are contingent upon credit approval. Maple Air reserves the right to modify pricing and packages without notice. By proceeding you acknowledge that you have read and understood these terms.</div>';
        // Print button
        html += '<button class="print-btn" onclick="window.print()">Print Quote</button>';
        // Footer (empty or minimal)
        html += '<footer></footer>';
        html += '</body></html>';
        const newWin = window.open('', '_blank');
        newWin.document.write(html);
        newWin.document.close();
      }
      // Print and email buttons on hidden summary section
      printBtn.addEventListener('click', () => {
        openSummaryWindow();
      });
      emailBtn.addEventListener('click', () => {
        let subject = 'Your Home Comfort Quote';
        let bodyLines = [];
        bodyLines.push('Thank you for choosing Maple Air!');
        bodyLines.push('Here is the summary of your selected units:');
        if (isCustom) {
          selectedUnits.forEach(name => {
            bodyLines.push('- ' + name);
          });
          const totals = calculateCustomTotals();
          bodyLines.push('Total Amount: $' + totals.total.toFixed(2));
          bodyLines.push('180 Monthly Payment Plan: $' + totals.monthly.toFixed(2) + '/month');
          bodyLines.push('Maple Care Included: $' + totals.care.toFixed(2) + '/month');
        } else if (selectedVariant) {
          selectedVariant.units.forEach(u => {
            bodyLines.push('- ' + u.name);
          });
          bodyLines.push('Total Amount: $' + selectedVariant.total_amount.toFixed(2));
          bodyLines.push('180 Monthly Payment Plan: $' + selectedVariant.monthly_payment.toFixed(2) + '/month');
          bodyLines.push('Maple Care Included: $' + selectedVariant.maple_care.toFixed(2) + '/month');
        }
        const body = bodyLines.join('\n');
        window.location.href = 'mailto:service@mapleair.com?subject=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(body);
      });
    })();
  </script>
</body>
</html>